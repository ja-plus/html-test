<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>录屏</title>
  <style>
    body {
      margin:0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .operate-btn {
      --icon-size: 20px;
      width: 100px;
      height: 50px;
      border-radius: 10px;
      outline: none;
      box-shadow: 0 0 5px #aaa;
      border: 1px solid #aaa;
      background-color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all cubic-bezier(.11,.73,.26,1.01) 0.5s;
    }

    .operate-btn:hover {
      transform: scale(1.2);
      box-shadow: 0px 0px 10px #aaa;
      /* background-color: #efefef; */
    }
    .operate-btn:hover::before {
      filter: drop-shadow(0 0 4px #aaa);
    }
    .operate-btn:active {
      transform:scale(0.9);
      box-shadow: 0px 0px 2px #aaa;
    }

    .operate-btn::before {
      content: '';
      display: block;
      margin: 0 auto;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .btn-record::before {
      width: var(--icon-size);
      height: var(--icon-size);
      border-radius: calc(var(--icon-size) / 2);
      background-color: #000;
    }

    .btn-record.active::before {
      background-color: #ff0000;
    }

    .btn-resume::before {
      width: 0;
      height: 0;
      border-top: calc(var(--icon-size) / 2) solid transparent;
      border-left: calc(var(--icon-size) * 0.8) solid;
      border-bottom: calc(var(--icon-size) / 2) solid transparent;
    }

    .btn-pause::before {
      width: 0;
      height: var(--icon-size);
      border-left: var(--icon-size) double #000;
    }

    .btn-end::before {
      width: var(--icon-size);
      height: var(--icon-size);
      border-radius: calc(var(--icon-size) / 4);
      background-color: #000;
    }
  </style>
</head>

<body>
  <div class="toolbar">
    <button id="btnStart" class="operate-btn btn-record" title="开始录制"></button>
    <button id="btnPause" class="operate-btn btn-pause" title="暂停录制"></button>
    <button id="btnEnd" class="operate-btn btn-end" title="结束录制"></button>
  </div>
</body>
<script>
  /**
   * @author JA+
   */
  const btnStart = document.querySelector('#btnStart');
  const btnPause = document.querySelector('#btnPause');
  const btnEnd = document.querySelector('#btnEnd');

  /** @type {MediaRecorder}*/
  let recorder;
  btnStart.addEventListener('click', () => {
    navigator.mediaDevices
      .getDisplayMedia({
        audio: true,
        video: { width: 1920, height: 1080 }, // video: true
      })
      .then(stream => {
        recorder = new MediaRecorder(stream, {
          /* mimeType: 'video/mp4'*/
        });
        let data = [];
        recorder.ondataavailable = function (e) {
          data.push(e.data);
        };
        recorder.onstop = function () {
          btnStart.classList.remove('active');
          recorder.stream.getTracks().forEach(track => track.stop());
          let blob = new Blob(data, { type: this.mimeType });

          let link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = new Date().toLocaleString() + '.webm';
          link.click();
          URL.revokeObjectURL(link.href);
          link.remove();
        };
        recorder.start();
        btnStart.classList.add('active');
      });
  });
  btnPause.addEventListener('click', () => {
    if (recorder.state === 'recording') {
      recorder.pause();
      btnPause.classList.replace('btn-pause', 'btn-resume');
    } else if (recorder.state === 'paused') {
      recorder.resume();
      btnPause.classList.replace('btn-resume', 'btn-pause');
    }
  });
  btnEnd.addEventListener('click', () => {
    recorder.stop();
  });
</script>

</html>