<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Hello PWA</title>
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="main.css">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="manifest" href="manifest.jsonc">
  <style>
    .add-button {
      position: absolute;
      top: 1px;
      left: 1px;
    }
  </style>
</head>

<body>
  <h3>Hello PWA2</h3>
  msg:<input type="text" id="msgText"/>
  <button onclick="fetchApi(1)">click fetch</button>
  <button onclick="fetchApi(2)">click fetch2</button>
  <button id="notifications">Notification</button>
  <button class="add-button">Add to home screen</button>
</body>
<script>
  // 检测浏览器是否支持SW
  if (navigator.serviceWorker != null) {
    navigator.serviceWorker.register('sw.js').then(function (registartion) {
      console.log('支持sw:', registartion.scope);
    });
  }
  // function fetchApi(no) {
  //   fetch('http://localhost:3000/getTestData?a=' + no)
  //     .then(res => res.json())
  //     .then(json => {
  //       console.log(json);
  //     });
  // }
  // const button = document.getElementById('notifications');
  // button.addEventListener('click', () => {
  //   Notification.requestPermission().then(result => {
  //     console.log('Notification:', result);
  //     if (result === 'granted') {
  //       // randomNotification();
  //       new Notification('通知', {
  //         body: '通知的正文',
  //         icon: 'images/icon_256x256.png',
  //         image: '../../html/img/searah.jpg',
  //         data: '123123',
  //       }); // https://developer.mozilla.org/zh-CN/docs/Web/API/notification/Notification
  //     }
  //   });
  // });

  // let deferredPrompt;
  // const addBtn = document.querySelector('.add-button');
  // addBtn.style.display = 'none';
  // window.addEventListener('beforeinstallprompt', e => {
  //   // Prevent Chrome 67 and earlier from automatically showing the prompt
  //   e.preventDefault();
  //   // 保存事件
  //   deferredPrompt = e;
  //   // 显示按钮
  //   addBtn.style.display = 'block';

  //   addBtn.addEventListener('click', e => {
  //     // 隐藏按钮
  //     addBtn.style.display = 'none';
  //     // 打开提示用户安装弹窗
  //     deferredPrompt.prompt();
  //     // 弹窗点击事件回调
  //     deferredPrompt.userChoice.then(choiceResult => {
  //       if (choiceResult.outcome === 'accepted') {
  //         console.log('User accepted the A2HS prompt');
  //       } else {
  //         console.log('User dismissed the A2HS prompt');
  //       }
  //       deferredPrompt = null;
  //     });
  //   });
  // });
</script>

</html>